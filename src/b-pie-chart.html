<element name="b-pie-chart">
    <style>
    :host {
        font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    path.slice {
        stroke-width:2px;
    }
    polyline {
        opacity: .3;
        stroke: black;
        stroke-width: 2px;
        fill: none;
    }
    </style>
    <script src="../node_modules/d3/d3.js"></script>
    <script>

    var color = d3.scale.category20c();

    ({
        set data(data) {
            this._data = data;
            this._render();
        },

        get isDynamic() {
            return this.hasAttribute('dynamic');
        },

        get radius() {
            return ~~this.getAttribute('radius') || 100;
        },

        createdCallback: function() {
            // The svg>g root element
            this.svg = d3.select(this)
                .append("svg")
                .attr("width", (this.radius) * 2).attr("height", (this.radius) * 2)
                .append("g")
                .attr("transform", "translate(" + this.radius + "," + this.radius + ")");

            // The group of slices
            this.svg.append("g")
                .attr("class", "slices");

            // The pie layout using to calculate angles from 0 to 2pi https://github.com/mbostock/d3/wiki/Pie-Layout#pie
            this.pie = d3.layout.pie()
                .sort(null)
                .value(function(d) {
                    return d;
                });

            // The arc generator https://github.com/mbostock/d3/wiki/SVG-Shapes#arc
            this.arc = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(this.radius);

            var _currentDatum;
            this.tween = function(d) {
                var interpolate = d3.interpolate(_currentDatum || d, d);
                _currentDatum = interpolate(0);
                return function(t) {
                    return this.arc(interpolate(t));
                }.bind(this);
            }.bind(this);
        },

        _render: function() {

            var slice = this.svg.select(".slices").selectAll("path.slice").data(this.pie(this._data));

            // Create new slice as needed
            slice.enter()
                .insert("path")
                .style("fill", function(d, i) {
                    return color(i);
                })
                .attr("class", "slice");

            // Insert data with transition
            if (this.isDynamic) {
                slice
                    .transition().duration(1000)
                    .attrTween("d", this.tween);
            }
            else {
                slice.attr("d", function(d) {
                    return this.arc(d);
                }.bind(this));
            }

            slice.exit()
                .remove();
        }
    });
    </script>
</element>
